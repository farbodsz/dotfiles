#-------------------------------------------------------------------------------
# neomuttrc
#-------------------------------------------------------------------------------


set realname="Farbod Salamat-Zadeh"
source ~/.dotfiles/neomutt/.config/neomutt/accounts.muttrc
source ~/.dotfiles/neomutt/.config/neomutt/theme.muttrc

# Mail folders
set folder = "imaps://imap.gmail.com:993"
set spoolfile = "+INBOX"
set postponed = "+[Gmail]/Drafts"

# Gmail saves sent mail to +[Gmail]/Sent, so we do not want duplicates.
unset record

# Caching helps speed things up
set header_cache = "~/.cache/neomutt/headers"
set message_cachedir = "~/.cache/neomutt/bodies"

# Check for mail every 2 mins
set mail_check = 120

# Get all mailboxes from subscribed IMAP folders
set imap_check_subscribed

# Speed up folder switching
set sleep_time = 0

# Index format
set index_format="%3C | %Z %{%d %b %y}  %-25.25L  (%-4.4c)  %s"
 
# Sort mail
set sort = reverse-threads
set sort_aux = last-date-received

# Disable the "Press any key to continue" after external programs run
set wait_key = no

# Setup sidebar and set binding to toggle it
set sidebar_visible
set sidebar_format = " %B%?F? [%F]?%* %?N?%N/?%S "
set sidebar_sort_method = "path"
set mail_check_stats

# Indent subfolders by shortening mailbox name with "/" as delimiter
set sidebar_short_path
set sidebar_delim_chars="/"
set sidebar_folder_indent
set sidebar_indent_string="  "

# Display the index above the pager view
set pager_index_lines = 10

# Show context lines when going to next page;
# Stop at end of page instead of going to next mail
set pager_context = 5
set pager_stop

# Show headers when composing mail
set edit_headers

# Convert markdown emails to HTML before sending on <C-h>
macro compose \Ch "F pandoc -s -f markdown -t html \ny^T^Utext/html; charset=utf-8\n"

# Fast reply: don't ask To/From when replying and always include original mail
set fast_reply
set include

# General bindings
bind pager j next-line
bind pager k previous-line
bind attach,index,pager \Cd next-page
bind attach,index,pager \Cu previous-page
bind pager g top
bind pager G bottom
bind attach,index g first-entry
bind attach,index G last-entry

# Sidebar bindings
bind index,pager B sidebar-toggle-visible
bind index,pager \Cj sidebar-next
bind index,pager \Ck sidebar-prev
bind index,pager \Cl sidebar-open

# Automatically improve HTML rendering using text-mode browser
set mailcap_path = ~/.dotfiles/neomutt/.config/neomutt/mailcap
auto_view text/html

# Open in browser
macro attach \CO "<pipe-entry>iconv -c --to-code=UTF8 > /tmp/mail.html<enter><shell-escape>$BROWSER /tmp/mail.html<enter>"

# View list of links on page with <C-b>. Follow links with urlview
macro pager \CB <pipe-entry>'urlview'<enter> 'Follow links with urlview'
